package ru.cryhards.brootkiddie.items

/**
 * Represents a malware used for attacks
 */
class Malware(name: String, info: String) : Item(name, info, Item.Type.MALWARE) {
    /**
     * Pieces of code that is is combined of
     */
    var scripts = ArrayList<Script>()

    constructor(name: String, info: String, vararg scripts: Script) : this(name, info) {
        for (s in scripts)
            this.scripts.add(s)
    }


    /**
     * Represents malware parameters
     */
    val stats = Stats()

    /**
     * Represents malware parameters
     */
    class Stats {
        var suspiciousness = 0f
        var spreadingSpeed = 0f
        var infectiousness = 0f
        var miningSpeed = 0f

        /**
         * Adds extra value to the stats
         */
        fun modulateBy(stats: Stats) {
            suspiciousness += stats.suspiciousness
            spreadingSpeed += stats.spreadingSpeed
            infectiousness += stats.infectiousness
            miningSpeed += stats.miningSpeed
        }
    }

    /**
     * Adds new script to this and returns this
     */
    fun combine(script: Script): Malware {
        name += script.name.subSequence(0, 3)
        info += " and " + script.name
        scripts.add(script)
        return this
    }

    operator fun plus(script: Script) = combine(script)


    /**
     * Recalculates malware stats
     */
    fun update() {
        stats.suspiciousness = 0f
        stats.spreadingSpeed = 0f
        stats.infectiousness = 0f
        stats.miningSpeed = 0f

        scripts.forEach { stats.modulateBy(it.affection()) }
    }


    override fun toString(): String {
        return "Infectiousness: ${stats.infectiousness}" +
                "Spreading Speed: ${stats.spreadingSpeed}" +
                "Suspiciousness: ${stats.suspiciousness}" +
                "Mining Speed: ${stats.miningSpeed}"
    }

}